<app-header></app-header>
<br>
<br>
<br>
<br>
<br>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />

<div id="main-content" class="blog-page">
  <div class="container">
    <div class="row clearfix">
      <!-- Main Content -->
      <div class="col-lg-8 col-md-12 left-box">
        <!-- Blog Post -->
        <div class="card single_post">
          <div class="body">
            <div class="img-post">
              <img *ngIf="blog && blog.imagepath; else placeholder" class="d-block img-fluid" [src]="getImageUrl(blog.imagepath)" [alt]="blog.title">
              <ng-template #placeholder>
                <img class="d-block img-fluid" src="https://www.bootdey.com/image/800x280/87CEFA/000000" alt="Placeholder">
              </ng-template>
            </div>
            <h3><a [routerLink]="['/blog', blog?.idBlog]">{{ blog?.title }}</a></h3>
            <p>{{ blog?.content }}</p>
          </div>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="alert alert-danger">
          {{ errorMessage }}
        </div>

        <!-- Comments Section -->
        <div class="card">
          <div class="header">
            <h2>Comments ({{ blog?.comments?.length }})</h2>
          </div>
          <div class="body">
            <ul class="comment-reply list-unstyled">
              <li class="row clearfix" *ngFor="let comment of comments">
                <div class="icon-box col-md-2 col-4">
                  <img
                    class="img-fluid img-thumbnail"
                    [src]="comment.user?.profileImage || 'https://bootdey.com/img/Content/avatar/avatar7.png'"
                    [alt]="comment.user?.firstName || 'Avatar'">
                </div>
                <div class="text-box col-md-10 col-8 p-l-0 p-r0">
                  <h5 class="m-b-0">{{ comment.user?.firstName}} {{ comment.user?.lastName || '' }}</h5>
                  <p class="com">{{ comment.content }}</p>
                  <ul class="list-inline">
                    <li *ngIf="isCommentEditable(comment)">
                      <a href="javascript:void(0);" (click)="editComment(comment)">Edit</a>
                    </li>
                    <li *ngIf="isCommentEditable(comment)">
                      <a href="javascript:void(0);" (click)="deleteComment(comment.idComment!)">Delete</a>
                    </li>
                  </ul>
                </div>
              </li>
              <li *ngIf="comments.length === 0" class="text-center">
                No comments yet.
              </li>
            </ul>
          </div>
        </div>

        <!-- Comment Form -->
        <div class="card">
          <div class="header">
            <h2>{{ isEditing ? 'Edit Comment' : 'Leave a reply' }} <small>Your email address will not be published. Required fields are marked*</small></h2>
          </div>
          <div class="body">
            <div class="comment-form">
              <form class="row clearfix" #commentForm="ngForm" (ngSubmit)="submitComment(commentForm)">
                <div class="col-sm-12">
                  <div class="form-group">
                    <textarea rows="4" class="form-control no-resize" placeholder="Please type what you want..." name="content" ngModel required></textarea>
                  </div>
                  <button type="submit" class="btn btn-block btn-primary" [disabled]="commentForm.invalid">{{ isEditing ? 'Update' : 'Submit' }}</button>
                  <button type="button" class="btn btn-block btn-secondary" *ngIf="isEditing" (click)="resetForm(commentForm)">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="col-lg-4 col-md-12 right-box">
        <!-- Search -->
        <div class="card">
          <div class="body search">
            <div class="input-group m-b-0">
              <div class="input-group-prepend">
                <span class="input-group-text"><i class="fa fa-search"></i></span>
              </div>
              <input type="text" class="form-control" placeholder="Search...">
            </div>
          </div>
        </div>

        <!-- Categories -->
        <div class="card">
          <div class="header">
            <h2>Categories Clouds</h2>
          </div>
          <div class="body widget">
            <ul class="list-unstyled categories-clouds m-b-0">
              <li *ngFor="let category of categories"><a href="javascript:void(0);">{{ category }}</a></li>
            </ul>
          </div>
        </div>

        <!-- Popular Posts -->
        <div class="card">
          <div class="header">
            <h2>Popular Posts</h2>
          </div>
          <div class="body widget popular-post">
            <div class="row">
              <div class="col-lg-12" *ngFor="let post of popularPosts">
                <div class="single_post">
                  <p class="m-b-0">{{ post.title }}</p>
                  <span>{{ post.date }}</span>
                  <div class="img-post">
                    <img [src]="post.imageUrl ?? 'https://www.bootdey.com/image/280x280/87CEFA/000000'" alt="Popular Post Image">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>