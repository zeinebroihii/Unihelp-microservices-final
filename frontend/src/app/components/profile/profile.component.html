<app-header></app-header>
<div class="profile-background modern-bg">
  <div class="modern-profile-card">
    <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>
    <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>
    <div *ngIf="!user" class="loading">Loading profile...</div>
    <div *ngIf="user" class="profile-content">
      <div class="modern-profile-header">
        <div class="modern-profile-image">
          <img [src]="getProfileImageUrl()" alt="Profile Image" />
          <span class="modern-status-dot" [class.active]="!user.banned" title="Account status"></span>
        </div>
        <div class="modern-profile-info">
          <div class="modern-profile-main">
            <h2 class="modern-user-name">{{ user.firstName }} {{ user.lastName }}</h2>
            <span class="modern-role-tag" *ngIf="user.role === 'STUDENT'">Student</span>
          </div>
          <span class="modern-user-email">{{ user.email }}</span>
          <span class="modern-user-id">ID: {{ user.id }}</span>
        </div>
      </div>
      <div *ngIf="!isEditing" class="modern-profile-details">
        <p class="modern-user-bio">{{ user.bio || 'No bio provided' }}</p>
        <div class="modern-user-skills">
          <ng-container *ngFor="let skill of (user.skills?.split(',') || [])">
            <span class="modern-skill-tag">{{ skill }}</span>
          </ng-container>
        </div>
        <div class="modern-action-buttons">
          <button (click)="toggleEdit()" class="modern-edit-btn">Edit Profile</button>
          <button (click)="toggleBioAnalysis()" class="modern-analyze-btn">
            {{ showBioAnalysis ? 'Hide Analysis' : 'Analyze My Bio' }}
          </button>
        </div>
        <div *ngIf="showBioAnalysis" class="bio-analysis-wrapper mt-4">
          <h4 class="analysis-title">Bio Analysis</h4>
          <div *ngIf="isAnalysisLoading" class="text-center p-3">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Analyzing your bio...</p>
          </div>
          <app-bio-analysis 
            *ngIf="!isAnalysisLoading" 
            [userId]="user.id" 
            [bio]="user.bio || ''" 
            (analysisComplete)="onAnalysisComplete($event)"
            (addSkill)="addSkillToProfile($event)"
            (addInterest)="addInterestToProfile($event)">
          </app-bio-analysis>
        </div>
      </div>
      <form *ngIf="isEditing" [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="profile-form">
        <div class="form-group">
          <label for="firstName">First Name</label>
          <input id="firstName" formControlName="firstName" class="form-control" />
          <div *ngIf="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched" class="text-danger">First name is required.</div>
        </div>
        <div class="form-group">
          <label for="lastName">Last Name</label>
          <input id="lastName" formControlName="lastName" class="form-control" />
          <div *ngIf="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched" class="text-danger">Last name is required.</div>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input id="email" formControlName="email" class="form-control" [disabled]="true" />
        </div>
        <div class="form-group">
          <label for="bio">Bio</label>
          <textarea id="bio" formControlName="bio" class="form-control"></textarea>
        </div>
        <div class="form-group">
          <label for="skills">Skills (comma-separated)</label>
          <input id="skills" formControlName="skills" class="form-control" />
        </div>
        <div class="form-actions">
          <button type="submit" [disabled]="profileForm.invalid" class="save-btn">Save</button>
          <button type="button" (click)="toggleEdit()" class="cancel-btn">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
